<!DOCTYPE html>
<html lang="en" xml:lang="en" dir="ltr">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="theme-color" content="#000000" />
        <meta name="description" content="" />

        <title>AdAdapted: Payload SDK Test</title>

        <style src="../html-javascript/app.css"></style>

        <script>
            const testUserId = "47c8b5bc82e2f4baa111bfa45e2d0e07";
            var payloadServiceSdk;

            function updateDisplayedPayloads(payloads) {
                document.getElementById("userPayloads").innerHTML = "";

                for (let x = 0; x < payloads.length; x++) {
                    const payloadElement = document.createElement("div");
                    const payloadName = document.createElement("div");
                    const payloadActions = document.createElement("div");
                    const processPayloadButton = document.createElement("button");

                    payloadElement.className = "user-payload";
                    processPayloadButton.onclick = function () {
                        payloadServiceSdk.removeUserPayload(testUserId, payloads[x].payloadUuid);
                    };

                    payloadName.append(payloads[x].customData.name);
                    processPayloadButton.append("Process Payload");
                    payloadActions.append(processPayloadButton);
                    payloadElement.append(payloadName);
                    payloadElement.append(payloadActions);

                    document.getElementById("userPayloads").append(payloadElement);
                }

                if (payloads.length) {
                    document.getElementById("processAllUserPayloads").innerHTML = "";

                    const processAllPayloadsButton = document.createElement("button");

                    processAllPayloadsButton.onclick = function () {
                        payloadServiceSdk.removeUserPayloads(testUserId);
                    };

                    processAllPayloadsButton.append("Process All User Payloads");

                    document.getElementById("processAllUserPayloads").append(processAllPayloadsButton);
                }
            }

            function scheduleUserPayload(payloadId) {
                payloadServiceSdk.schedulePayload(testUserId, payloadId);
            }

            function recordUserImpression(payloadId) {
                payloadServiceSdk.recordImpression(testUserId, payloadId);
            }

            function onPayloadSdkAvailable() {
                payloadServiceSdk = new AdAdapatedPayloadServiceSdk("HTOQKOHEBTVISUV", "dev", {
                    onDescribePayload: {
                        success: (response) => {
                            console.log("Describe Payload: SUCCESS");
                            console.log("Describe Payload Response:", response);
                        },
                        error: () => {
                            console.log("Describe Payload: ERROR");
                        },
                    },
                    onRetrieveUserPayloads: {
                        success: (response) => {
                            console.log("Retrieve User Payloads: SUCCESS");
                            console.log("Retrieve User Payloads Response:", response);

                            if (response && response.length) {
                                payloadServiceSdk.describePayload(response[0].payloadUuid);
                            }

                            updateDisplayedPayloads(response);
                        },
                        error: () => {
                            console.log("Retrieve User Payloads: ERROR");
                        },
                    },
                    onRemoveUserPayload: {
                        success: () => {
                            console.log("User Payload Removal: SUCCESS");

                            payloadServiceSdk.retrieveUserPayloads(testUserId);
                        },
                        error: () => {
                            console.log("User Payload Removal: ERROR");
                        },
                    },
                    onRemoveUserPayloads: {
                        success: () => {
                            console.log("User Payloads Removal: SUCCESS");

                            payloadServiceSdk.retrieveUserPayloads(testUserId);
                        },
                        error: () => {
                            console.log("User Payloads Removal: ERROR");
                        },
                    },
                    onRecordImpression: {
                        success: () => {
                            console.log("Record Impression: SUCCESS");
                        },
                        error: () => {
                            console.log("Record Impression: ERROR");
                        },
                    },
                    onSchedulePayload: {
                        success: () => {
                            console.log("Schedule Payload: SUCCESS");

                            payloadServiceSdk.retrieveUserPayloads(testUserId);
                        },
                        error: () => {
                            console.log("Schedule Payload: ERROR");
                        },
                    },
                });

                // Get the Payloads for a user.
                console.log("SDK Configuration:", payloadServiceSdk.getSdkConfiguration());
                payloadServiceSdk.retrieveUserPayloads(testUserId);
            }
        </script>
        <script src="./adadapted-payload-service-sdk.js" onload="onPayloadSdkAvailable()"></script>
    </head>
    <body>
        <div class="App">
            <div className="user-id-display">
                <div>User ID:</div>
                <div id="userIdDisplay"></div>
            </div>
            <div id="userPayloads"></div>
            <div id="processAllUserPayloads"></div>
            <div className="add-payload-buttons">
                <button onclick="scheduleUserPayload('3325513c-0883-4c1d-99c5-c02e28472eda')">
                    Add Payload: Beeswax Test #1 (noscript)
                </button>
                <button onclick="scheduleUserPayload('cf8c4fa1-1932-4a60-a1a3-74f220c6582f')">
                    Add Payload: Beeswax Test #1 (script)
                </button>
                <button onclick="scheduleUserPayload('6eed6389-cbc6-4d6f-a1fe-d7b2bcc7386c')">
                    Add Payload: Coors Light 24pk
                </button>
            </div>
            <div className="record-payload-impression-buttons">
                <button onclick="recordUserImpression('3325513c-0883-4c1d-99c5-c02e28472eda')">
                    Record Impression: Beeswax Test #1 (noscript)
                </button>
                <button onclick="recordUserImpression('cf8c4fa1-1932-4a60-a1a3-74f220c6582f')">
                    Record Impression: Beeswax Test #1 (script)
                </button>
                <button onclick="recordUserImpression('6eed6389-cbc6-4d6f-a1fe-d7b2bcc7386c')">
                    Record Impression: Coors Light 24pk
                </button>
            </div>
        </div>
    </body>
</html>
